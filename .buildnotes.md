# Build Notes

These notes describe the supported local build flow and the GitHub Actions CI matrix.
Use `build/build.py` for all local builds.

## Local Builds (build/build.py)

`build/build.py` is the only supported local entry point. It handles environment setup,
Conan dependency resolution, build directory initialization, build, and tests.

### Supported compilers (local)

- `msvc` (Windows, default)
- `clang` (Windows host, build runs in WSL Ubuntu)
- `gcc` (non-Windows only)

Build output directories are created per compiler:
`.msvc_build`, `.clang_build`, `.gcc_build`.

### macOS status

macOS is unverified. There is no CI coverage for macOS, and the Unix setup
script currently targets Linux. Treat macOS builds as unsupported until
explicitly validated.

### Common usage

Windows (PowerShell):
```powershell
# Debug build with MSVC (default)
python build/build.py

# Release build
python build/build.py --config Release

# Clean build
python build/build.py --clean

# Multiple compilers in one run
python build/build.py --compilers msvc,clang

# Skip tests
python build/build.py --no-tests
```

macOS/Linux (bash):
```bash
# Debug build with GCC or Clang
python3 build/build.py --compilers gcc
python3 build/build.py --compilers clang

# Release build
python3 build/build.py --config Release
```

### Options

- `--config {Debug|Release}` (default: Debug)
- `--compilers msvc,clang,gcc` (comma-separated)
- `--clean` / `--rebuild` (cleans build directory before building)
- `--no-tests` (skip tests)
- `--skip-setup` (skip dependency setup verification)
- `--skip-venv-setup` (skip Conda/WSL setup; intended for troubleshooting only)
- `--coverage` (clang Debug on Linux only)

### Environment behavior

- Windows MSVC builds expect Visual Studio/MSVC to be installed locally.
- MSVC/GCC builds run inside the Conda environment `build_si_units_1.0`.
- Clang builds on Windows run inside WSL Ubuntu; the script installs clang-18,
  libc++, CMake, Ninja, and Conan if missing. This can modify your WSL Ubuntu
  setup and does not use Conda there, so run at your own risk.

Conda is used to provision build tools (e.g., Conan 2, CMake, Ninja, Clang/LLVM)
for local builds; it does not install Visual Studio/MSVC itself.

### Do not use for local builds

- Direct CMake invocation
- PowerShell build scripts in `build/scripts/`
- Direct MSVC/clang/gcc commands

## CI Builds (GitHub Actions)

The CI workflow is defined in `.github/workflows/ci.yml` and runs on pull requests
to `main` and `development`. It covers a broader matrix than local builds.

Matrix (OS / compiler / build type):

- Windows: MSVC and Clang, Debug + Release
- Ubuntu: GCC and Clang, Debug + Release

CI uses Conan profiles from `build/profiles` and configures CMake + Ninja (MSVC
uses the Visual Studio generator). Toolchain versions include GCC 13 and Clang 18
on Ubuntu.
